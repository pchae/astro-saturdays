---
import DashboardLayout from "../layouts/DashboardLayout.astro";
import DashboardHeader from "../components/DashboardHeader.astro";
import StatCard from "../components/StatCard.astro";
import FighterSection from "../components/FighterSection.astro";
import { checkAuth } from "../lib/auth.ts";

// Use the auth middleware
export const prerender = false;
const authResult = await checkAuth(Astro);
if (authResult.redirect) return authResult.redirect;

// Get user data from session
const user = authResult.session?.data?.user;
const email = user?.email;

// Dashboard data
const stats = [
  { name: 'Number of deploys', value: '9999' },
  { name: 'Average deploy time', value: '32', unit: 'seconds' },
  { name: 'Instances', value: '1' },
  { name: 'Status', value: 'ONLINE' },
];

// Mock fighter data - in a real app, this would come from an API or database
const ufcFighters = [
  { id: '1', name: 'Jon Jones', organization: 'UFC', image: '/pfp/2335639.png' },
  { id: '2', name: 'Alex Pereira', organization: 'UFC', image: '/pfp/4705658.png' },
  { id: '3', name: 'Alexander Volkanovski', organization: 'UFC', image: '/pfp/3949584.png' },
];
---

<DashboardLayout title="Dashboard - Saturdays.io" email={email} user={user}>
  <section>
    <DashboardHeader />

    <!-- Stats -->
    <dl class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 mt-8 gap-0">
      {stats.map(stat => (
        <StatCard stat={stat} />
      ))}
    </dl>

    <!-- Fighter sections -->
    <div class="pt-8">
      <FighterSection title="UFC Fighters" fighters={ufcFighters} />
    </div>
  </section>
</DashboardLayout>